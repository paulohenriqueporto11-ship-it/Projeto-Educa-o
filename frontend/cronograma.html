<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minha Rotina - Estuda.IA 2.0</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="assets/css/style.css">

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>
<body>
    <audio id="audio-rain" loop src="https://cdn.pixabay.com/download/audio/2022/05/17/audio_38363a01ea.mp3?filename=heavy-rain-19365.mp3"></audio>
    <audio id="audio-lofi" loop src="https://cdn.pixabay.com/download/audio/2022/02/10/audio_fc8c4592b2.mp3?filename=chill-lofi-song-8444.mp3"></audio>
    <audio id="audio-white" loop src="https://cdn.pixabay.com/download/audio/2021/08/09/audio_8ed024765d.mp3?filename=white-noise-8117.mp3"></audio>

    <div id="configModal" class="modal-overlay" style="display:flex;"> 
        <div class="modal-box">
            <h2>üöÄ Seu Cronograma</h2>
            <p style="color:var(--text-muted); margin-bottom:20px;">O que vamos destruir hoje?</p>

            <label style="font-weight:600;">Escolha o Foco:</label>
            <div class="track-grid" id="trackSelector">
                <div class="track-option" onclick="selectTrack(this, 'med')">ü©∫ Sa√∫de</div>
                <div class="track-option" onclick="selectTrack(this, 'eng')">üìê Exatas</div>
                <div class="track-option" onclick="selectTrack(this, 'hum')">‚öñÔ∏è Humanas</div>
                <div class="track-option" onclick="selectTrack(this, 'custom')">‚öôÔ∏è Personalizado</div>
            </div>

            <div id="customArea" class="custom-track-input">
                <p style="font-size:0.8rem; margin-bottom:5px;">Selecione as mat√©rias:</p>
                <div style="display:flex; gap:5px; flex-wrap:wrap;">
                    <button class="subject-chip" onclick="toggleSubject(this, 'mat')">Matem√°tica</button>
                    <button class="subject-chip" onclick="toggleSubject(this, 'red')">Reda√ß√£o</button>
                    <button class="subject-chip" onclick="toggleSubject(this, 'nat')">Natureza</button>
                    <button class="subject-chip" onclick="toggleSubject(this, 'hum')">Humanas</button>
                </div>
            </div>

            <div class="slider-container">
                <div class="slider-label">
                    <span>Meta de Tempo</span>
                    <span id="hoursVal" style="color:var(--primary)">2h 00m</span>
                </div>
                <input type="range" min="0.5" max="8" step="0.5" value="2" id="hoursInput" oninput="updateHoursLabel(this.value)">
            </div>

            <button class="btn-save" onclick="saveConfig()">Gerar Miss√µes</button>
        </div>
    </div>

    <nav>
        <div class="logo">‚ú® Estuda.IA</div>
        <div class="nav-right">
             <div class="study-timer" id="navTimer">00:00</div>
             <button class="btn-outline" onclick="openConfig()">‚öôÔ∏è</button>
        </div>
    </nav>

    <div class="container">
        
        <div class="timer-deck">
            <h3 style="margin-bottom:20px; opacity:0.8">Modo Foco Profundo</h3>
            
            <div class="timer-ring" id="timerRing">
                <div class="timer-inner">
                    <div class="timer-display" id="displayTimer">00:00</div>
                    <div class="timer-label" id="timerStatus">Pronto?</div>
                </div>
            </div>
            
            <div class="timer-controls">
                <button class="btn-timer btn-stop" onclick="resetTimer()">‚èπ Reset</button>
                <button class="btn-timer btn-play" id="playBtn" onclick="toggleTimer()">‚ñ∂ INICIAR</button>
            </div>

            <a href="#" onclick="openConfig(); return false;" class="timer-config-link">
                ‚öôÔ∏è Ajustar Tempo e Mat√©ria
            </a>

            <div class="sound-bar">
                <button class="sound-btn" id="btn-rain" onclick="toggleAudio('rain')">üåß Chuva</button>
                <button class="sound-btn" id="btn-lofi" onclick="toggleAudio('lofi')">‚òï Lo-Fi</button>
                <button class="sound-btn" id="btn-white" onclick="toggleAudio('white')">üìª Ru√≠do</button>
            </div>
        </div>

        <div>
            <div style="margin-bottom:20px;">
                <h2 id="trackTitle">Suas Miss√µes</h2>
                <p style="color:var(--text-muted)">Complete para ganhar XP e manter a ofensiva.</p>
            </div>
            <div id="missionsList">
                </div>
        </div>
    </div>

    <script>
        // --- 1. CONFIGURA√á√ÉO E DADOS ---
        let state = {
            track: 'custom',
            customSubjects: [],
            goalMinutes: 120, // 2 horas padrao
            elapsedSeconds: 0,
            isRunning: false,
            completed: []
        };
        
        let timerInterval = null;
        let currentAudio = null;

        // BANCO DE QUEST√ïES COM LINKS REAIS (INTERNOS)
        const DB = {
            mat: { t: "Matem√°tica", d: "Lista: Geometria Plana", xp: 150, i: "üìê", url: "simulados.html?materia=matematica" },
            red: { t: "Reda√ß√£o", d: "Escrever: Tema da Semana", xp: 300, i: "üìù", url: "redacao.html" },
            nat: { t: "Natureza", d: "Revis√£o: Estequiometria", xp: 150, i: "üß™", url: "simulados.html?materia=natureza" },
            hum: { t: "Humanas", d: "Quiz: Revolu√ß√£o Industrial", xp: 100, i: "üè∫", url: "simulados.html?materia=humanas" },
            // Presets
            med: ['nat', 'nat', 'red', 'mat'],
            eng: ['mat', 'mat', 'nat', 'red'],
            hum: ['hum', 'hum', 'red', 'mat']
        };

        // --- 2. LOGICA DO MODAL ---
        function openConfig() { document.getElementById('configModal').style.display = 'flex'; }
        
        function selectTrack(el, type) {
            document.querySelectorAll('.track-option').forEach(e => e.classList.remove('selected'));
            el.classList.add('selected');
            state.track = type;
            
            // Mostra area personalizada se for custom
            document.getElementById('customArea').style.display = (type === 'custom') ? 'block' : 'none';
        }

        function toggleSubject(btn, subj) {
            btn.classList.toggle('selected');
            if(state.customSubjects.includes(subj)) {
                state.customSubjects = state.customSubjects.filter(s => s !== subj);
            } else {
                state.customSubjects.push(subj);
            }
        }

        function updateHoursLabel(val) {
            const h = Math.floor(val);
            const m = (val % 1) * 60;
            document.getElementById('hoursVal').innerText = `${h}h ${m===0?'00':m}m`;
            state.goalMinutes = val * 60;
        }

        function saveConfig() {
            document.getElementById('configModal').style.display = 'none';
            renderMissions();
            resetTimer(); // Reseta timer pra nova meta
        }

        // --- 3. GERA√á√ÉO DE MISS√ïES ---
        function renderMissions() {
            const list = document.getElementById('missionsList');
            list.innerHTML = '';
            
            let subjectsToLoad = [];
            
            if (state.track === 'custom') {
                subjectsToLoad = state.customSubjects.length > 0 ? state.customSubjects : ['red', 'mat']; // Fallback
            } else {
                subjectsToLoad = DB[state.track] || DB['med'];
            }

            subjectsToLoad.forEach((key, idx) => {
                const missionData = DB[key] || DB['mat'];
                const isDone = state.completed.includes(idx);
                
                // CRIA√á√ÉO DO CARD
                const div = document.createElement('div');
                div.className = `mission-card ${isDone ? 'mission-done' : ''}`;
                
                // Bot√£o agora √© um LINK <a> REAL
                div.innerHTML = `
                    <div class="mission-left">
                        <div class="mission-icon">${missionData.i}</div>
                        <div class="mission-info">
                            <h3>${missionData.t}</h3>
                            <p>${missionData.d}</p>
                            <span class="xp-badge">+${missionData.xp} XP</span>
                        </div>
                    </div>
                    <a href="${missionData.url}" class="btn-start" onclick="markAsDone(${idx})">
                        ${isDone ? 'Conclu√≠do ‚úÖ' : 'Ir Agora ‚ûî'}
                    </a>
                `;
                list.appendChild(div);
            });

            document.getElementById('trackTitle').innerText = state.track === 'custom' ? 'Seu Plano Personalizado' : 'Plano de Estudos';
        }

        function markAsDone(idx) {
            if(!state.completed.includes(idx)) {
                state.completed.push(idx);
                // Aqui voc√™ pode salvar no localStorage se quiser
            }
        }

        // --- 4. TIMER REFEITO ---
        function toggleTimer() {
            const btn = document.getElementById('playBtn');
            const status = document.getElementById('timerStatus');

            if (state.isRunning) {
                // PAUSAR
                clearInterval(timerInterval);
                state.isRunning = false;
                btn.innerText = "‚ñ∂ CONTINUAR";
                btn.style.background = "#4F46E5";
                status.innerText = "Pausado";
            } else {
                // INICIAR
                state.isRunning = true;
                btn.innerText = "‚è∏ PAUSAR";
                btn.style.background = "#F59E0B";
                status.innerText = "Focando...";
                
                timerInterval = setInterval(() => {
                    state.elapsedSeconds++;
                    updateDisplay();
                }, 1000);
            }
        }

        function resetTimer() {
            clearInterval(timerInterval);
            state.isRunning = false;
            state.elapsedSeconds = 0;
            document.getElementById('playBtn').innerText = "‚ñ∂ INICIAR";
            document.getElementById('playBtn').style.background = "#10B981";
            document.getElementById('timerStatus').innerText = "Pronto?";
            updateDisplay();
        }

        function updateDisplay() {
            const hours = Math.floor(state.elapsedSeconds / 3600);
            const minutes = Math.floor((state.elapsedSeconds % 3600) / 60);
            const seconds = state.elapsedSeconds % 60;

            const fmt = (n) => n.toString().padStart(2, '0');
            const timeString = hours > 0 
                ? `${fmt(hours)}:${fmt(minutes)}:${fmt(seconds)}` 
                : `${fmt(minutes)}:${fmt(seconds)}`;

            document.getElementById('displayTimer').innerText = timeString;
            document.getElementById('navTimer').innerText = timeString;

            // Barra Circular
            const totalGoalSeconds = state.goalMinutes * 60;
            let percent = (state.elapsedSeconds / totalGoalSeconds) * 100;
            if (percent > 100) percent = 100;
            
            document.getElementById('timerRing').style.background = 
                `conic-gradient(#10B981 ${percent}%, rgba(255,255,255,0.1) 0%)`;
        }

        // --- 5. SISTEMA DE √ÅUDIO ---
        function toggleAudio(type) {
            const audioEl = document.getElementById(`audio-${type}`);
            const btn = document.getElementById(`btn-${type}`);

            if (currentAudio === type) {
                audioEl.pause();
                currentAudio = null;
                btn.classList.remove('playing');
            } else {
                ['rain', 'lofi', 'white'].forEach(t => {
                    document.getElementById(`audio-${t}`).pause();
                    document.getElementById(`btn-${t}`).classList.remove('playing');
                });

                audioEl.volume = 0.5;
                audioEl.play().catch(e => console.log("Erro ao tocar √°udio:", e));
                currentAudio = type;
                btn.classList.add('playing');
            }
        }

        // Inicializa√ß√£o
        selectTrack(document.querySelector('.track-option'), 'med'); 
    </script>
</body>
</html>
