<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Planejador - Estuda.IA</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4F46E5">
    <link href="assets/css/style.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
</head>
<body>

    <div id="configModal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <h2 style="margin-bottom: 10px;">Personalize seu Estudo</h2>
            <p style="color:var(--text-muted); margin-bottom: 20px;">O que voc√™ quer estudar?</p>

            <label style="font-weight:700; font-size:0.9rem;">MAT√âRIAS DO FOCO</label>
            <div class="chips-container" id="subjectChips">
                <div class="subject-chip" onclick="toggleSubject(this, 'mat')" data-val="mat">Matem√°tica</div>
                <div class="subject-chip" onclick="toggleSubject(this, 'nat')" data-val="nat">Natureza (F√≠s/Qu√≠/Bio)</div>
                <div class="subject-chip" onclick="toggleSubject(this, 'hum')" data-val="hum">Humanas (Hist/Geo)</div>
                <div class="subject-chip" onclick="toggleSubject(this, 'lin')" data-val="lin">Linguagens</div>
                <div class="subject-chip" onclick="toggleSubject(this, 'red')" data-val="red">Reda√ß√£o</div>
            </div>

            <label style="font-weight:700; font-size:0.9rem;">INTENSIDADE DI√ÅRIA</label>
            <div class="intensity-selector">
                <button class="intensity-btn" onclick="setIntensity('leve')" id="btnLeve">Leve (15min)</button>
                <button class="intensity-btn active" onclick="setIntensity('medio')" id="btnMedio">M√©dio (1h)</button>
                <button class="intensity-btn" onclick="setIntensity('hard')" id="btnHard">Hardcore (3h+)</button>
            </div>

            <button class="btn" style="width:100%" onclick="saveConfigAndClose()">Salvar Rotina</button>
        </div>
    </div>

    <nav>
        <div class="logo">‚ú® Estuda.IA</div>
        <a href="index.html" class="btn-outline" style="border:none; font-weight:600;">‚Üê Voltar</a>
    </nav>

    <div class="container">
        
        <div class="streak-bar">
            <div>
                <div style="font-size: 0.9rem; opacity: 0.9;">Ofensiva</div>
                <div class="streak-count">üî• <span id="streakDay">1</span> dias seguidos</div>
            </div>
            <div style="text-align: right;">
                <button class="btn-outline" style="color:white; border-color:rgba(255,255,255,0.5); padding: 5px 15px; font-size:0.8rem;" onclick="openConfig()">
                    ‚öôÔ∏è Configurar
                </button>
            </div>
        </div>

        <div class="view-toggle">
            <div class="toggle-btn active" id="viewDaily" onclick="switchView('daily')">Miss√µes de Hoje</div>
            <div class="toggle-btn" id="viewWeekly" onclick="switchView('weekly')">Vis√£o Semanal</div>
        </div>

        <div id="dailyContainer">
            <div id="missionsList"></div>
        </div>

        <div id="weeklyContainer" style="display: none;">
            <h3 style="margin-bottom: 20px; color:var(--text-muted);">Sua meta para os pr√≥ximos 7 dias:</h3>
            <div id="weeklyList"></div>
        </div>

    </div>

    <script>
        // --- BANCO DE DADOS DE MISS√ïES (Pool Gen√©rico) ---
        const missionPool = {
            mat: [
                { title: "Treino de L√≥gica", desc: "Resolva 5 quest√µes de Matem√°tica.", icon: "üìê", xp: 100, url: "simulados.html", type: "Matem√°tica" },
                { title: "Geometria B√°sica", desc: "Revise f√≥rmulas de √°reas.", icon: "üîµ", xp: 80, url: "simulados.html", type: "Matem√°tica" }
            ],
            nat: [
                { title: "Desafio de Natureza", desc: "Acerte quest√µes de F√≠sica ou Qu√≠mica.", icon: "‚öõÔ∏è", xp: 120, url: "simulados.html", type: "Natureza" },
                { title: "Biologia Celular", desc: "Simulado r√°pido de Biologia.", icon: "üß¨", xp: 100, url: "simulados.html", type: "Natureza" }
            ],
            hum: [
                { title: "Hist√≥ria do Brasil", desc: "Quest√µes sobre Era Vargas.", icon: "üìú", xp: 100, url: "simulados.html", type: "Humanas" },
                { title: "Geopol√≠tica", desc: "Entenda os conflitos atuais.", icon: "üåç", xp: 90, url: "simulados.html", type: "Humanas" }
            ],
            lin: [
                { title: "Interpreta√ß√£o de Texto", desc: "Treine leitura din√¢mica.", icon: "üìñ", xp: 80, url: "simulados.html", type: "Linguagens" }
            ],
            red: [
                { title: "Reda√ß√£o da Semana", desc: "Escreva sobre um tema aleat√≥rio.", icon: "üìù", xp: 200, url: "redacao.html" },
                { title: "Planejamento de Texto", desc: "Crie apenas a introdu√ß√£o de um tema.", icon: "‚úçÔ∏è", xp: 50, url: "redacao.html" }
            ]
        };

        // --- ESTADO DO USU√ÅRIO ---
        let userConfig = JSON.parse(localStorage.getItem('estudaia_config')) || {
            subjects: ['red', 'mat'], // Padr√£o
            intensity: 'medio',
            lastLogin: new Date().toDateString(),
            streak: 1,
            completedToday: []
        };

        // Inicializa√ß√£o
        function init() {
            // Se for primeiro acesso, abre config
            if(!localStorage.getItem('estudaia_config')) {
                openConfig();
            } else {
                renderMissions();
                renderWeekly();
            }
            document.getElementById('streakDay').innerText = userConfig.streak;
        }

        // --- GERA√á√ÉO DE MISS√ïES ---
        function generateDailyMissions() {
            let missions = [];
            const countMap = { 'leve': 1, 'medio': 3, 'hard': 5 };
            const count = countMap[userConfig.intensity] || 3;

            // Pega mat√©rias selecionadas
            const activeSubjects = userConfig.subjects;
            
            // Garante pelo menos 1 miss√£o
            if(activeSubjects.length === 0) activeSubjects.push('red');

            for(let i=0; i < count; i++) {
                // Escolhe mat√©ria aleat√≥ria das selecionadas
                const randSub = activeSubjects[Math.floor(Math.random() * activeSubjects.length)];
                // Escolhe miss√£o aleat√≥ria daquela mat√©ria
                const pool = missionPool[randSub];
                const mission = pool[Math.floor(Math.random() * pool.length)];
                
                // Cria ID √∫nico pro dia (ex: mat_0_2023-10-27)
                const missionId = `${randSub}_${i}_${userConfig.lastLogin}`;
                
                missions.push({ ...mission, id: missionId });
            }
            return missions;
        }

        function renderMissions() {
            const container = document.getElementById('missionsList');
            // Como n√£o temos backend, vamos gerar "pseudo-aleat√≥rio" baseado no dia
            // Para simplificar, vou gerar sempre que recarregar SE n√£o tiver salvo no dia
            // (Num app real, salvar√≠amos a lista do dia no banco)
            
            const missions = generateDailyMissions();
            
            let html = '';
            if(missions.length === 0) html = '<p style="text-align:center">Nenhuma mat√©ria selecionada.</p>';

            missions.forEach(m => {
                const isDone = userConfig.completedToday.includes(m.id);
                const btnText = m.url.includes('redacao') ? 'Escrever' : 'Jogar';
                const action = m.url.includes('simulados') 
                    ? `goToSimulado('${m.type}', '${m.id}')` 
                    : `goToLink('${m.url}', '${m.id}')`;

                html += `
                    <div class="mission-card ${isDone ? 'mission-done' : ''}">
                        <div class="mission-left">
                            <div class="mission-icon">${m.icon}</div>
                            <div class="mission-info">
                                <h3>${m.title}</h3>
                                <p>${m.desc}</p>
                                <span class="xp-badge">+${m.xp} XP</span>
                            </div>
                        </div>
                        <button class="btn-start" onclick="${action}">
                            ${isDone ? 'Feito ‚úÖ' : btnText + ' ‚Üí'}
                        </button>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        function renderWeekly() {
            // Gera uma vis√£o est√°tica baseada na intensidade
            const container = document.getElementById('weeklyList');
            const intensityMult = { 'leve': 5, 'medio': 15, 'hard': 30 };
            const total = intensityMult[userConfig.intensity];
            
            let html = `
                <div class="weekly-card">
                    <span style="font-size:2rem">üéØ</span>
                    <div><strong>Meta Total:</strong> Completar ${total} atividades.</div>
                </div>
            `;
            
            userConfig.subjects.forEach(sub => {
                const names = { 'mat': 'Matem√°tica', 'nat': 'Natureza', 'hum': 'Humanas', 'lin': 'Linguagens', 'red': 'Reda√ß√£o' };
                html += `
                    <div class="weekly-card">
                        <span style="font-size:1.5rem">üìÖ</span>
                        <div>Focar em <strong>${names[sub]}</strong> (Pelo menos 2x na semana)</div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        // --- SISTEMA DE CONFIGURA√á√ÉO (MODAL) ---
        let tempSubjects = [];
        let tempIntensity = 'medio';

        function openConfig() {
            document.getElementById('configModal').style.display = 'flex';
            // Carrega estado atual
            tempSubjects = [...userConfig.subjects];
            tempIntensity = userConfig.intensity;
            updateChipsUI();
            setIntensity(tempIntensity); // Atualiza visual
        }

        function toggleSubject(el, sub) {
            if(tempSubjects.includes(sub)) {
                tempSubjects = tempSubjects.filter(s => s !== sub);
                el.classList.remove('selected');
            } else {
                tempSubjects.push(sub);
                el.classList.add('selected');
            }
        }

        function updateChipsUI() {
            document.querySelectorAll('.subject-chip').forEach(chip => {
                if(tempSubjects.includes(chip.dataset.val)) chip.classList.add('selected');
                else chip.classList.remove('selected');
            });
        }

        function setIntensity(level) {
            tempIntensity = level;
            document.querySelectorAll('.intensity-btn').forEach(b => b.classList.remove('active'));
            const idMap = { 'leve': 'btnLeve', 'medio': 'btnMedio', 'hard': 'btnHard' };
            document.getElementById(idMap[level]).classList.add('active');
        }

        function saveConfigAndClose() {
            if(tempSubjects.length === 0) return alert("Selecione pelo menos uma mat√©ria!");
            
            userConfig.subjects = tempSubjects;
            userConfig.intensity = tempIntensity;
            localStorage.setItem('estudaia_config', JSON.stringify(userConfig));
            
            document.getElementById('configModal').style.display = 'none';
            renderMissions(); // Regera a lista com as novas configs
            renderWeekly();
        }

        // --- NAVEGA√á√ÉO ---
        function switchView(view) {
            document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
            if(view === 'daily') {
                document.getElementById('viewDaily').classList.add('active');
                document.getElementById('dailyContainer').style.display = 'block';
                document.getElementById('weeklyContainer').style.display = 'none';
            } else {
                document.getElementById('viewWeekly').classList.add('active');
                document.getElementById('dailyContainer').style.display = 'none';
                document.getElementById('weeklyContainer').style.display = 'block';
            }
        }

        function goToLink(url, id) {
            markDone(id);
            window.location.href = url;
        }

        function goToSimulado(type, id) {
            markDone(id);
            localStorage.setItem('simulado_auto_start', type);
            window.location.href = 'simulados.html';
        }

        function markDone(id) {
            if(!userConfig.completedToday.includes(id)) {
                userConfig.completedToday.push(id);
                localStorage.setItem('estudaia_config', JSON.stringify(userConfig));
            }
        }

        init();
    </script>
</body>
</html>
