<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minha Rotina - Estuda.IA 2.0</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --primary: #4F46E5;
            --primary-dark: #4338ca;
            --bg: #F3F4F6;
            --card: #FFFFFF;
            --text: #1F2937;
            --text-muted: #6B7280;
            --success: #10B981;
            --warning: #F59E0B;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: var(--text); padding-bottom: 80px; }

        /* HEADER & TIMER */
        header {
            background: var(--card);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo { font-weight: 800; font-size: 1.2rem; color: var(--primary); }

        /* DASHBOARD PRINCIPAL */
        .container { max-width: 600px; margin: 20px auto; padding: 0 20px; }

        /* NOVO CRON√îMETRO DECK */
        .timer-deck {
            background: linear-gradient(135deg, #1e1b4b, #312e81);
            color: white;
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 25px;
            position: relative;
            overflow: hidden;
        }

        .timer-ring {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: conic-gradient(var(--success) 0%, rgba(255,255,255,0.1) 0%);
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: 0 0 20px rgba(79, 70, 229, 0.4);
            transition: background 1s linear;
        }
        
        .timer-inner {
            width: 130px;
            height: 130px;
            background: #1e1b4b;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2;
        }

        .timer-display { font-size: 2rem; font-weight: 700; font-variant-numeric: tabular-nums; }
        .timer-label { font-size: 0.75rem; color: #a5b4fc; text-transform: uppercase; letter-spacing: 1px; }

        .timer-controls { display: flex; gap: 10px; justify-content: center; margin-top: 10px; }
        
        .btn-timer {
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.1s;
        }
        .btn-play { background: var(--success); color: white; padding: 10px 30px; font-size: 1.1rem; }
        .btn-stop { background: rgba(255,255,255,0.1); color: white; }
        .btn-timer:active { transform: scale(0.95); }

        /* SOUND BAR (Surpresa √ötil) */
        .sound-bar {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        .sound-btn {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: #a5b4fc;
            padding: 5px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            cursor: pointer;
        }
        .sound-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        /* MISS√ïES */
        .section-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 15px; }
        .section-title { font-size: 1.1rem; font-weight: 700; }
        
        .mission-card {
            background: var(--card);
            padding: 15px;
            border-radius: 16px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 1px solid #e5e7eb;
            transition: transform 0.2s;
        }
        .mission-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .mission-card.done { opacity: 0.6; background: #f9fafb; }
        
        .m-icon { font-size: 1.5rem; background: #e0e7ff; width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; border-radius: 12px; }
        .m-content { flex: 1; }
        .m-title { font-weight: 600; font-size: 0.95rem; margin-bottom: 2px; }
        .m-desc { font-size: 0.8rem; color: var(--text-muted); }
        .m-xp { font-size: 0.75rem; font-weight: 700; color: var(--primary); background: #e0e7ff; padding: 2px 6px; border-radius: 4px; display: inline-block; margin-top: 4px; }

        .btn-check {
            width: 32px; height: 32px;
            border-radius: 50%;
            border: 2px solid #d1d5db;
            background: transparent;
            cursor: pointer;
            display: flex; align-items: center; justify-content: center; color: white;
        }
        .mission-card.done .btn-check { background: var(--success); border-color: var(--success); }

        /* MODAL DE CONFIGURA√á√ÉO (Cronograma) */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
            z-index: 999;
            display: none;
            align-items: center;
            justify-content: center;
        }
        .modal-box {
            background: white; width: 90%; max-width: 500px;
            padding: 25px; border-radius: 20px;
            animation: slideUp 0.3s ease;
        }
        @keyframes slideUp { from {transform: translateY(20px); opacity: 0;} to {transform: translateY(0); opacity: 1;} }

        .track-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; }
        .track-option {
            border: 2px solid #e5e7eb; padding: 15px; border-radius: 12px;
            text-align: center; cursor: pointer; transition: 0.2s;
        }
        .track-option:hover { border-color: var(--primary); background: #f5f3ff; }
        .track-option.selected { border-color: var(--primary); background: #e0e7ff; color: var(--primary-dark); font-weight: 700; }
        
        .slider-container { margin: 20px 0; }
        .slider-label { display: flex; justify-content: space-between; margin-bottom: 5px; font-weight: 600; }
        input[type=range] { width: 100%; accent-color: var(--primary); }

        .btn-save { background: var(--primary); color: white; width: 100%; padding: 12px; border: none; border-radius: 10px; font-weight: 700; cursor: pointer; font-size: 1rem; }
    </style>
</head>
<body>

    <div id="configModal" class="modal-overlay">
        <div class="modal-box">
            <h2 style="margin-bottom:5px;">üöÄ Planeje sua Aprova√ß√£o</h2>
            <p style="color:var(--text-muted); font-size:0.9rem;">Personalize sua experi√™ncia de estudos.</p>

            <div style="margin-top:20px;">
                <label style="font-weight:600; font-size:0.9rem;">Qual √© o seu foco?</label>
                <div class="track-grid" id="trackSelector">
                    <div class="track-option" onclick="selectTrack(this, 'med')">ü©∫ Sa√∫de<br><span style="font-size:0.7rem; font-weight:400">Bio & Quim</span></div>
                    <div class="track-option" onclick="selectTrack(this, 'eng')">üìê Exatas<br><span style="font-size:0.7rem; font-weight:400">Mat & F√≠s</span></div>
                    <div class="track-option" onclick="selectTrack(this, 'hum')">‚öñÔ∏è Humanas<br><span style="font-size:0.7rem; font-weight:400">Hist & Geo</span></div>
                    <div class="track-option" onclick="selectTrack(this, 'all')">üìö Geral<br><span style="font-size:0.7rem; font-weight:400">Enem Padr√£o</span></div>
                </div>
            </div>

            <div class="slider-container">
                <div class="slider-label">
                    <span>Meta Di√°ria</span>
                    <span id="hoursVal" style="color:var(--primary)">4h 00m</span>
                </div>
                <input type="range" min="1" max="10" step="0.5" value="4" id="hoursInput" oninput="updateHoursLabel(this.value)">
                <p style="font-size:0.75rem; color:var(--text-muted); margin-top:5px;">Isso definir√° seu cron√¥metro e a quantidade de tarefas.</p>
            </div>

            <button class="btn-save" onclick="saveConfig()">Salvar Cronograma</button>
        </div>
    </div>

    <header>
        <div class="logo">‚ú® Estuda.IA</div>
        <div style="font-size:0.9rem; font-weight:600; color:var(--text-muted)" onclick="openConfig()">‚öôÔ∏è Ajustar</div>
    </header>

    <div class="container">
        
        <div class="timer-deck">
            <div class="timer-ring" id="timerRing">
                <div class="timer-inner">
                    <div class="timer-display" id="displayTimer">00:00</div>
                    <div class="timer-label" id="timerLabel">Focar</div>
                </div>
            </div>
            
            <div class="timer-controls">
                <button class="btn-timer btn-stop" onclick="resetTimer()">‚èπ</button>
                <button class="btn-timer btn-play" id="playBtn" onclick="toggleTimer()">‚ñ∂ Iniciar</button>
            </div>

            <div class="sound-bar">
                <div class="sound-btn" onclick="toggleSound(this, 'rain')">üåß Chuva</div>
                <div class="sound-btn" onclick="toggleSound(this, 'lofi')">‚òï Lo-Fi</div>
                <div class="sound-btn" onclick="toggleSound(this, 'white')">üìª White</div>
            </div>
            <p style="font-size:0.7rem; margin-top:10px; opacity:0.7">Sons para bloquear distra√ß√µes</p>
        </div>

        <div style="margin-bottom:20px; display:flex; justify-content:space-between; align-items:center;">
            <div>
                <h3 id="trackTitle">Cronograma Geral</h3>
                <p style="font-size:0.85rem; color:var(--text-muted)">Progresso di√°rio: <span id="progressText">0%</span></p>
            </div>
            <div style="text-align:right;">
                <div style="font-weight:800; color:#F59E0B; font-size:1.2rem;">üî• 5</div>
                <div style="font-size:0.7rem; color:var(--text-muted)">Dias seguidos</div>
            </div>
        </div>

        <div id="missionsList">
            </div>

    </div>

    <script>
        // ============================
        // 1. ESTADO & CONFIG
        // ============================
        let state = JSON.parse(localStorage.getItem('estudaia_v2_state')) || {
            config: { track: null, goalHours: 4 }, // Track: med, eng, hum, all
            today: new Date().toLocaleDateString(),
            completedMissions: [],
            elapsedSeconds: 0
        };

        // Reset di√°rio simples
        if (state.today !== new Date().toLocaleDateString()) {
            state.today = new Date().toLocaleDateString();
            state.completedMissions = [];
            state.elapsedSeconds = 0;
            saveState();
        }

        let timerInterval = null;
        let isRunning = false;
        let selectedTrackTemp = state.config.track || 'all';

        // ============================
        // 2. L√ìGICA DO MODAL (Cronograma)
        // ============================
        function openConfig() {
            document.getElementById('configModal').style.display = 'flex';
            // Pr√©-selecionar
            updateHoursLabel(state.config.goalHours);
            document.getElementById('hoursInput').value = state.config.goalHours;
            // Highlight track
            const opts = document.querySelectorAll('.track-option');
            opts.forEach(o => {
                if(o.textContent.toLowerCase().includes(getTrackName(state.config.track).toLowerCase())) 
                   o.classList.add('selected'); // L√≥gica simples de UI
            });
        }

        function selectTrack(el, trackCode) {
            document.querySelectorAll('.track-option').forEach(d => d.classList.remove('selected'));
            el.classList.add('selected');
            selectedTrackTemp = trackCode;
        }

        function updateHoursLabel(val) {
            const h = Math.floor(val);
            const m = (val - h) * 60;
            document.getElementById('hoursVal').innerText = `${h}h ${m === 0 ? '00' : m}m`;
        }

        function saveConfig() {
            state.config.track = selectedTrackTemp;
            state.config.goalHours = parseFloat(document.getElementById('hoursInput').value);
            saveState();
            document.getElementById('configModal').style.display = 'none';
            generateMissions(); // Regera baseado na nova escolha
            renderUI();
            updateTimerDisplay(); // Atualiza a meta do timer
        }

        // Se n√£o tiver config, abre o modal
        if (!state.config.track) {
            openConfig();
        }

        // ============================
        // 3. SISTEMA DE MISS√ïES DIN√ÇMICAS
        // ============================
        const MISSION_DB = {
            med: [
                { t: "Biologia Celular", d: "Resumo de Mitose e Meiose", xp: 200, i: "üß¨" },
                { t: "Qu√≠mica Org√¢nica", d: "Resolver 10 exerc√≠cios de Cadeias", xp: 150, i: "‚öóÔ∏è" },
                { t: "Reda√ß√£o Sa√∫de", d: "Tema: Desafios do SUS", xp: 300, i: "üìù" }
            ],
            eng: [
                { t: "F√≠sica - Mec√¢nica", d: "Leis de Newton: 15 Quest√µes", xp: 200, i: "üöÄ" },
                { t: "Matem√°tica B√°sica", d: "Revis√£o de Logaritmos", xp: 150, i: "üìê" },
                { t: "L√≥gica", d: "Desafio de Racioc√≠nio L√≥gico", xp: 100, i: "üß†" }
            ],
            hum: [
                { t: "Hist√≥ria do BR", d: "Era Vargas: Mapa Mental", xp: 200, i: "üìú" },
                { t: "Filosofia", d: "Ler resumo sobre Kant", xp: 150, i: "ü¶â" },
                { t: "Atualidades", d: "Ler 2 not√≠cias sobre Geopol√≠tica", xp: 100, i: "üåç" }
            ],
            all: [
                { t: "Revis√£o Geral", d: "Matem√°tica: Regra de 3", xp: 100, i: "üî¢" },
                { t: "Portugu√™s", d: "Crase: Teoria e Pr√°tica", xp: 150, i: "üìñ" },
                { t: "Reda√ß√£o", d: "Escrever introdu√ß√£o de tema livre", xp: 200, i: "‚úçÔ∏è" }
            ]
        };

        function generateMissions() {
            // Em um app real, isso viria do backend ou seria aleat√≥rio
            // Aqui pegamos fixo do DB baseado na escolha
            return MISSION_DB[state.config.track] || MISSION_DB['all'];
        }

        // ============================
        // 4. ENGINE DO TIMER
        // ============================
        function toggleTimer() {
            if (isRunning) {
                clearInterval(timerInterval);
                document.getElementById('playBtn').innerHTML = "‚ñ∂ Continuar";
                document.getElementById('playBtn').style.background = "#4F46E5";
                document.getElementById('timerLabel').innerText = "Pausado";
            } else {
                timerInterval = setInterval(() => {
                    state.elapsedSeconds++;
                    if(state.elapsedSeconds % 10 === 0) saveState(); // Salva a cada 10s
                    updateTimerDisplay();
                }, 1000);
                document.getElementById('playBtn').innerHTML = "‚è∏ Pausar";
                document.getElementById('playBtn').style.background = "#F59E0B";
                document.getElementById('timerLabel').innerText = "Focando...";
            }
            isRunning = !isRunning;
        }

        function resetTimer() {
            clearInterval(timerInterval);
            isRunning = false;
            // Opcional: Zerar ou apenas parar? Vamos apenas parar e manter o progresso do dia.
            document.getElementById('playBtn').innerHTML = "‚ñ∂ Iniciar";
            document.getElementById('playBtn').style.background = "#10B981";
            document.getElementById('timerLabel').innerText = "Pronto?";
            updateTimerDisplay(); // Mant√©m o display atualizado
        }

        function updateTimerDisplay() {
            // Formata HH:MM:SS
            const h = Math.floor(state.elapsedSeconds / 3600);
            const m = Math.floor((state.elapsedSeconds % 3600) / 60);
            const s = state.elapsedSeconds % 60;
            
            document.getElementById('displayTimer').innerText = 
                `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}`;

            // Atualiza Anel de Progresso
            const goalSeconds = state.config.goalHours * 3600;
            let percent = (state.elapsedSeconds / goalSeconds) * 100;
            if(percent > 100) percent = 100;

            const ring = document.getElementById('timerRing');
            // Truque CSS para barra circular
            ring.style.background = `conic-gradient(#10B981 ${percent}%, rgba(255,255,255,0.1) 0%)`;
            
            document.getElementById('progressText').innerText = Math.round(percent) + '% da meta';
        }

        // ============================
        // 5. RENDER UI
        // ============================
        function renderUI() {
            const list = document.getElementById('missionsList');
            const missions = generateMissions();
            let html = '';

            document.getElementById('trackTitle').innerText = "Cronograma: " + getTrackName(state.config.track);

            missions.forEach((m, index) => {
                const isDone = state.completedMissions.includes(index);
                html += `
                    <div class="mission-card ${isDone ? 'done' : ''}">
                        <div class="m-icon">${m.i}</div>
                        <div class="m-content">
                            <div class="m-title">${m.t}</div>
                            <div class="m-desc">${m.d}</div>
                            <div class="m-xp">+${m.xp} XP</div>
                        </div>
                        <button class="btn-check" onclick="toggleMission(${index})">
                            ${isDone ? '‚úî' : ''}
                        </button>
                    </div>
                `;
            });

            list.innerHTML = html;
            updateTimerDisplay();
        }

        function toggleMission(index) {
            if(state.completedMissions.includes(index)) return; // J√° feito
            
            state.completedMissions.push(index);
            saveState();
            renderUI();
            
            // Efeito visual
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 }
            });
        }

        // ============================
        // 6. UTILIT√ÅRIOS & AUDIO
        // ============================
        function getTrackName(code) {
            const map = { 'med': 'Medicina/Sa√∫de', 'eng': 'Engenharia/Exatas', 'hum': 'Direito/Humanas', 'all': 'Geral/Enem' };
            return map[code] || 'Geral';
        }

        function saveState() {
            localStorage.setItem('estudaia_v2_state', JSON.stringify(state));
        }

        // Mock de Audio Player (Simula√ß√£o visual e l√≥gica)
        let activeAudio = null;
        function toggleSound(btn, type) {
            // Em produ√ß√£o, aqui voc√™ colocaria: new Audio('assets/rain.mp3').play();
            
            // Reset visual
            document.querySelectorAll('.sound-btn').forEach(b => b.classList.remove('active'));

            if (activeAudio === type) {
                activeAudio = null; // Desliga
                // audioObject.pause();
            } else {
                btn.classList.add('active');
                activeAudio = type;
                // audioObject.play();
                console.log("Tocando som: " + type);
            }
        }

        // Inicializa
        renderUI();

    </script>
</body>
</html>
