<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estuda.IA - Dashboard</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4F46E5">
    
    <link href="assets/css/style.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
</head>
<body>

    <nav>
        <div class="logo">âœ¨ Estuda.IA</div>
        <div style="font-weight:600">Aluno</div>
    </nav>

    <div class="container">
        <h1 style="margin-bottom: 24px;">Seu Progresso</h1>
        
        <div class="stats-grid">
            <div class="stat-card">
                <span class="stat-val" id="totalRedacoes">--</span>
                <span class="stat-label">RedaÃ§Ãµes Feitas</span>
            </div>
            <div class="stat-card">
                <span class="stat-val" id="mediaGeral">--</span>
                <span class="stat-label">MÃ©dia Geral</span>
            </div>
        </div>

        <h2 style="margin-bottom: 24px;">Ferramentas</h2>
        <div class="tools-grid">
            <div class="tool-card" onclick="document.getElementById('modalTema').style.display='flex'">
                <div>
                    <span class="tool-icon">ğŸ“</span>
                    <div class="tool-title">Nova RedaÃ§Ã£o</div>
                    <div class="tool-desc">Corretor automÃ¡tico com IA baseado nas competÃªncias do ENEM.</div>
                </div>
            </div>
            <div class="tool-card" style="opacity:0.6; cursor:default">
                <div>
                    <span class="tool-icon">ğŸ“š</span>
                    <div class="tool-title">Simulados (Em breve)</div>
                    <div class="tool-desc">Banco de questÃµes para treinar conhecimentos gerais.</div>
                </div>
            </div>
        </div>
    </div>

    <div id="modalTema" class="modal-overlay" onclick="if(event.target === this) this.style.display='none'">
        <div class="modal-content">
            <h3 style="margin-bottom: 20px; text-align: center;">Escolha o Tema</h3>
            
            <button class="modal-option" onclick="irParaRedacao('Livre')">
                <span style="font-size:1.5rem">âœï¸</span>
                <div><strong>Livre</strong><br><small style="color:var(--text-muted)">Qualquer assunto</small></div>
            </button>
            
            <button class="modal-option" onclick="gerarAleatorio()">
                <span style="font-size:1.5rem">ğŸ²</span>
                <div><strong>AleatÃ³rio</strong><br><small style="color:var(--text-muted)">Sorteio estilo ENEM</small></div>
            </button>
            
            <button class="modal-option" onclick="temaPersonalizado()">
                <span style="font-size:1.5rem">ğŸ¯</span>
                <div><strong>Personalizado</strong><br><small style="color:var(--text-muted)">Digite seu tema</small></div>
            </button>
        </div>
    </div>

    <script>
        const API_BASE = "https://backend-redacao.onrender.com/api";

        let userId = localStorage.getItem('estudaia_id');
        if (!userId) {
            userId = 'u_' + Math.random().toString(36).substr(2, 9);
            localStorage.setItem('estudaia_id', userId);
        }

        async function carregarStats() {
            try {
                const res = await fetch(`${API_BASE}/estatisticas?userId=${userId}`);
                const data = await res.json();
                document.getElementById('totalRedacoes').innerText = data.total;
                const mediaElem = document.getElementById('mediaGeral');
                mediaElem.innerText = data.media;
                if(data.media > 800) mediaElem.style.color = 'var(--success)';
            } catch(e) { console.error(e); }
        }

        function irParaRedacao(tema) {
            localStorage.setItem('temaRedacao', tema);
            window.location.href = 'redacao.html';
        }

        function temaPersonalizado() {
            const t = prompt("Digite o tema:");
            if(t && t.length > 3) irParaRedacao(t);
        }

        function gerarAleatorio() {
            const temas = ["O estigma das doenÃ§as mentais", "Caminhos para combater a intolerÃ¢ncia religiosa", "Desafios da educaÃ§Ã£o a distÃ¢ncia", "SeguranÃ§a alimentar no Brasil"];
            irParaRedacao(temas[Math.floor(Math.random()*temas.length)]);
        }

        carregarStats();
    </script>
</body>
</html>
